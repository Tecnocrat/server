# AIOS Supercell - Traefik Dynamic Configuration

# HTTP Routes and Services (static configuration since Docker provider is failing)
http:
  routers:
    # Traefik Dashboard
    dashboard:
      rule: "Host(`traefik.lan`)"
      service: api@internal
      entrypoints:
        - web
    
    # Prometheus
    prometheus:
      rule: "Host(`prometheus.lan`)"
      service: prometheus
      entrypoints:
        - web
    
    # Grafana
    grafana:
      rule: "Host(`grafana.lan`)"
      service: grafana
      entrypoints:
        - web
    
    # Loki
    loki:
      rule: "Host(`loki.lan`)"
      service: loki
      entrypoints:
        - web
    
    # Vault
    vault:
      rule: "Host(`vault.lan`)"
      service: vault
      entrypoints:
        - web
    
    # Whoami
    whoami:
      rule: "Host(`whoami.lan`)"
      service: whoami
      entrypoints:
        - web
  
  services:
    # Prometheus
    prometheus:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:9090"
    
    # Grafana
    grafana:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:3000"
    
    # Loki
    loki:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:3100"
    
    # Vault
    vault:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:8200"
    
    # Whoami
    whoami:
      loadBalancer:
        servers:
          - url: "http://aios-whoami:80"

  middlewares:
    # Security headers
    secure-headers:
      headers:
        sslRedirect: true
        stsSeconds: 31536000
        stsIncludeSubdomains: true
        stsPreload: true
        forceSTSHeader: true
        frameDeny: true
        contentTypeNosniff: true
        browserXssFilter: true
        referrerPolicy: "same-origin"
    
    # Rate limiting
    rate-limit:
      rateLimit:
        average: 100
        period: 1s
        burst: 50
    
    # IP whitelist (local network only)
    local-only:
      ipWhiteList:
        sourceRange:
          - "127.0.0.1/32"
          - "192.168.0.0/16"
          - "172.16.0.0/12"
          - "10.0.0.0/8"
